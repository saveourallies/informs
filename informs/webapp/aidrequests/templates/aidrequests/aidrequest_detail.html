{% extends "base.html" %}
{% load bootstrap_icons %}
{% load crispy_forms_tags %}

{% block content %}
<div class="row flex-row align-items-center my-1">
    <div class="col-auto display-6 font-monospace">
        Aid Request Detail
    </div>
    <div class="col-auto font-monospace bg-light ms-4 p-0" style="font-size: 0.75rem;">
        <table class="table border border-1 m-0 p-0">
            <tr>
                <td class="border border-info bg-transparent m-0 px-1 py-0">
                    priority:
                    {{ object.priority }}
                </td>
                <td class="border border-info bg-transparent m-0 px-1 py-0">
                    created:
                    {{ object.created_at|date:"Y-m-d H:i" }}
                    ({{ object.created_by }})
                </td>
            </tr>
            <tr>
                <td class="border border-info bg-transparent m-0 px-1 py-0">
                    status:
                    {{ object.status }}
                </td>
                <td class="border border-info bg-transparent m-0 px-1 py-0">
                    updated:
                    {{ object.updated_at|date:"Y-m-d H:i" }}
                    ({{ object.updated_by }})
                </td>

            </tr>
        </table>
    </div>
</div>
<hr class="m-0" />
<div class="container font-monospace mt-1">
    <div class="d-flex flex-column flex-lg-row">
        <div class="table-responsive">
            <table class="table table-bordered table-data w-auto caption-top me-2 border border-3 border-success">
                <caption>Aid Summary</caption>
                <tr>
                    <th class="col-auto">ID</th>
                    <th class="col-auto">Field Op</th>
                    <th class="col-auto">Aid Type</th>
                    <th class="col-auto">Group Size</th>
                </tr>
                <tr>
                    <td class="col-auto">
                        <a href="{% url 'aidrequest_update' pk=aidrequest.pk field_op=field_op.slug %}" class="btn btn-warning btn-sm mx-1 p-1">
                            {% bs_icon "pencil" %} {{ object.pk }}
                        </a>
                    </td>
                    <td class="col-auto">                     
                        <a href="{% url 'aidrequest_list' field_op=field_op.slug %}" class="btn btn-outline-info btn-sm mx-1 p-1">
                            {% bs_icon "truck" %} {{ field_op.name }}
                        </a>
                    </td>
                    <td class="col-auto">{{ object.get_assistance_type_display }}</td>
                    <td class="col-auto text-center">{{ object.group_size }}</td>
                </tr>
                <tr>
                    <tr><th colspan="4">Descripton</th></tr>
                    <td colspan="4">
                        {{ object.assistance_description }}
                    </td>
                </tr>
            </table>
        </div>
        <div class="table-responsive">
            <table class="table table-bordered table-data border border-3 border-info w-auto caption-top mb-1">
                <caption>Contact Information</caption>
                <tr>
                    <th class="col-auto">Requestor Name</th>
                    <th class="col-auto">Requestor Phone</th>
                    <th class="col-auto">Requestor Email</th>
                </tr>
                <tr>
                    <td class="col-auto">{{ object.requestor_first_name }} {{ object.requestor_last_name }}</td>
                    <td class="col-auto">{{ object.requestor_phone }}</td>
                    <td class="col-auto">{{ object.requestor_email }}</td>
                </tr>
                <tr>
                    <th class="col-auto">Contact Name</th>
                    <th class="col-auto">Contact Phone</th>
                    <th class="col-auto">Contact Email</th>
                </tr>
                <tr>
                    <td class="col-auto">{{ object.assistance_first_name|default:"None" }} {{ object.assistance_last_name }}</td>
                    <td class="col-auto">{{ object.assistance_phone|default:"None" }}</td>
                    <td class="col-auto">{{ object.assistance_email|default:"None" }}</td>
                </tr>
                <tr>
                    <td colspan="3">
                        <strong>Methods</strong>:<br>{{ object.contact_methods }}
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>
<hr>
<div class="row flex-row align-items-center my-1">
    <div class="col-auto font-monospace">
        <table class="table table-bordered table-data w-auto caption-top w-auto border border-3 border-warning font-monospace ms-4">
            <caption>Aid Location</caption>
            <tr>
                <th class="col-auto">Address Provided</th>
                {% if not location_confirmed %}
                    <th class="col-auto">Geocoder</th>
                {% endif %}
                {% if map_image %}
                    <th class="col-auto">Azure Map</th>
                {% endif %}
            </tr>
            <tr>
                <td class="col-auto">
                    {{ object.street_address }}<br>
                    {{ object.city }}, {{ object.state }} {{ object.zip_code }}
                    <hr>
                    Status:<br>
                    {% if location_confirmed %}
                        <span class="text-success">{% bs_icon "check" %}Confirmed</span>
                    {% else %}
                        <span class="text-danger">Not Confirmed</span>
                    {% endif %}
                </td>
                {% if not location_confirmed %}
                    <td>
                        {% if geocode_form %}
                            {% crispy geocode_form %}
                        {% endif %}
                    </td>
                {% endif %}
                {% if map_image %}
                    <td class="col-auto">
                        <div>Field Op: {{fieldop_lat}},{{fieldop_lon}}</div>
                        <div>Aid Location: {{aid_lat}},{{aid_lon}}</div>
                        <div>
                            <div id="map-image">
                                <img src="{{ map_image }}" alt="Aid Request - Location Map">
                            </div>
                        </div>
                    </td>
                {% endif %}
            </tr>
        </table>
    </div>
    <div class="col-auto ms-4 p-0">

    </div>
</div>
<div class="container font-monospace">
    <table class="table table-sm table-data table-success table-striped">
        <thead>
            <tr>
                <th scope="col-auto">Location</th>
                <th scope="col-auto">Notes</th>
                </th>
            </tr>
        </thead>
        <tbody>
            {% for location in locations %}
            <tr>
                <td class="ps-2">
                    <div class="d-inline-flex">
                        <div class=" px-1 mx-1">
                            {{ location.latitude }},{{ location.longitude }}
                        </div>
                        <a href="https://google.com/maps/place/{{ location.latitude }},{{ location.longitude }}/@{{ location.latitude }},{{ location.longitude }},13z"
                                                            target="_blank" class="btn btn-outline-success btn-sm">
                            {% bs_icon "globe2" %}
                        </a>
                    </div>
                    <div>
                        Status: {{ location.status }}<br>
                    </div>
                    <div>
                        <small>{{ location.updated_at|date:"Y-m-d H:i" }}</small>
                    </div>
                    <div class="d-inline-flex border bg-warning-subtle border-warning border-2 rounded align-items-center p-1">
                        <small class="me-2">{{ location.source }}</small>
                        <a href="{% url 'aid_location_delete' field_op=field_op.slug aid_request=object.pk pk=location.pk  %}" class="btn btn-danger btn-sm w-auto">
                            {% bs_icon "trash" %}
                        </a>
                    </div>
                </td>
                <td>
                    <pre>{{ location.note }}</pre>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<hr>
<h2>Emergency Medical Needs</h2>
<p>{{ object.medical_needs|default:"None" }}</p>

<h2>Supplies Needed</h2>
<p>{{ object.supplies_needed|default:"None" }}</p>

<h2>Welfare Check Information</h2>
<p>{{ object.welfare_check_info|default:"None" }}</p>

<h2>Additional Information</h2>
<p>{{ object.additional_info|default:"None" }}</p>
<hr>
<h4>Activity Logs</h4>
<div class="container font-monospace">
    <table class="table table-sm table-warning table-striped table-bordered w-100" style="font-size: 0.75rem;">
        <thead>
            <tr>
                <th class="col-2">Updated</th>
                <th class="col">Log</th>
            </tr>
        </thead>
        <tbody>
            {% for log in logs %}
            <tr>
                <td class="col-2">
                    <div class="d-inline-flex">
                        {{ log.updated_at|date:"Y-m-d H:i" }}
                        ({{ log.updated_by }})
                    </div>
                </td>
                <td class="col">
                    <div>
                        <pre>{{ log.log_entry }}</pre>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<h6>Add Notes</h6>
<div class="container font-monospace">
    {% if log_form %}
        {% crispy log_form %}
    {% endif %}
</div>
<hr>
<table class="table table-bordered table-data w-auto caption-top border border-3 border-primary font-monospace"
                style="font-size: 0.75rem;">
    <caption>Ticket Info</caption>
    <tr>
        <th class="col-auto">Created At</th>
        <th class="col-auto">Updated At</th>
        <th class="col-auto">Locations</th>
    </tr>
    <tr>
        <td class="col-auto">{{ object.created_at|date:"Y-m-d H:i" }}</td>
        <td class="col-auto">{{ object.updated_at|date:"Y-m-d H:i" }}</td>
        <td class="col-auto">{{ locations|length }}
            {% if location_confirmed %}
            <span class="text-success">{% bs_icon "check" %} ok</span>
        {% else %}
            <span class="text-danger">{% bs_icon "exclamation" color="red" %} NOT CONFIRMED</span>
        {% endif %}
        </td>
    </tr>
</table>

{% endblock %}
